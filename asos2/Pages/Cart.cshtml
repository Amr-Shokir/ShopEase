@page
@model IsisStore.Pages.CartModel
@{
    ViewData["Title"] = "My Bag";
}

<div class="cart-container">
    <h1 class="page-title">SHOPPING BAG</h1>

    @if (Model.CartItems.Count == 0)
    {
        <div style="text-align:center; margin-top: 50px;">
            <p style="font-size: 16px; color: #666;">Your bag is currently empty.</p>
            <a href="/" style="text-decoration: underline; font-weight: bold; color: #000;">Continue Shopping</a>
        </div>
    }
    else
    {
        <div class="cart-layout">

            <div class="cart-items-column">
                @foreach (var item in Model.CartItems)
                {
                    <div class="cart-item-card">
                        <div class="cart-img-wrapper">
                            <img src="@Model.GetWebImage(item.Product.CoverImageURL)" alt="@item.Product.Name" />
                        </div>

                        <div class="cart-details">
                            <div class="cart-header">
                                <h4 class="cart-product-name">@item.Product.Name</h4>
                                <span class="cart-price">$@(item.Product.DiscountPrice ?? item.Product.Price)</span>
                            </div>

                            <p class="cart-meta">Size: @item.SizeName</p>

                            <div class="cart-actions-row">

                                <form method="post" asp-page-handler="UpdateQuantity" class="qty-selector-form">
                                    <input type="hidden" name="id" value="@item.CartItemID" />

                                    <button type="submit" name="change" value="-1" class="qty-btn-small">
                                        <i class="fa-solid fa-minus"></i>
                                    </button>

                                    <span class="qty-display-text">@item.Quantity</span>

                                    <button type="submit" name="change" value="1" class="qty-btn-small">
                                        <i class="fa-solid fa-plus"></i>
                                    </button>
                                </form>

                                <form method="post" asp-page-handler="Remove" asp-route-id="@item.CartItemID">
                                    <button type="submit" class="remove-link">REMOVE</button>
                                </form>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <div class="cart-summary-column">
                <div class="summary-card">
                    <h3>TOTAL</h3>

                    <div class="summary-row">
                        <span>Sub-total</span>
                        <span>$@Model.SubTotal</span>
                    </div>

                    <div class="summary-row">
                        <span>Delivery</span>
                        <span>$@Model.Shipping</span>
                    </div>

                    <div class="summary-divider"></div>

                    <div class="summary-row total-row">
                        <span>Total</span>
                        <span>$@Model.TotalPrice</span>
                    </div>

                    <a href="/Checkout" class="checkout-btn">CHECKOUT</a>

                    <div class="secure-checkout">
                        <i class="fa-solid fa-lock"></i> Secure Checkout
                    </div>
                </div>
            </div>

        </div>
    }
</div>